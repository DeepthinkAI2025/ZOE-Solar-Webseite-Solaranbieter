<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOE Solar - Kundensegment-Cluster Visualisierung</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        .cluster-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .cluster-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .privat { border-left-color: #3498db; }
        .gewerbe { border-left-color: #e74c3c; }
        .landwirtschaft { border-left-color: #27ae60; }
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .metric-label { font-weight: bold; }
        .metric-value { color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ZOE Solar - Kundensegment-Cluster Analyse</h1>
        <p>Diese Visualisierung zeigt die Ergebnisse der Kundensegment-Clustering-Analyse für ZOE Solar.</p>
    </div>

    <div class="container">
        <h2>Cluster-Verteilung</h2>
        <div class="chart-container">
            <canvas id="clusterChart"></canvas>
        </div>
    </div>

    <div class="container">
        <h2>Verbrauch vs. Budget nach Segment</h2>
        <div class="chart-container">
            <canvas id="scatterChart"></canvas>
        </div>
    </div>

    <div class="container">
        <h2>Cluster-Details</h2>
        <div class="cluster-summary" id="clusterSummary">
            <!-- Wird mit JavaScript gefüllt -->
        </div>
    </div>

    <script>
        // Lade die Clustering-Daten
        fetch('./visualization-data.json')
            .then(response => response.json())
            .then(data => {
                createCharts(data);
                createClusterSummary(data);
            })
            .catch(error => console.error('Fehler beim Laden der Daten:', error));

        function createCharts(data) {
            // Cluster-Verteilungs-Chart
            const clusterLabels = data.clusters.map(c => c.name);
            const clusterSizes = data.clusters.map(c => c.size);

            const clusterColors = ['#3498db', '#e74c3c', '#27ae60'];

            new Chart(document.getElementById('clusterChart'), {
                type: 'doughnut',
                data: {
                    labels: clusterLabels,
                    datasets: [{
                        data: clusterSizes,
                        backgroundColor: clusterColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Kundenverteilung nach Segment'
                        }
                    }
                }
            });

            // Scatter-Plot: Jahresverbrauch vs Budget
            const datasets = data.clusters.map((cluster, index) => ({
                label: cluster.name,
                data: cluster.members.map(member => ({
                    x: member.jahresverbrauch,
                    y: member.budget
                })),
                backgroundColor: clusterColors[index],
                pointRadius: 4,
                pointHoverRadius: 6
            }));

            new Chart(document.getElementById('scatterChart'), {
                type: 'scatter',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Jahresverbrauch (kWh)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Budget (€)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Verbrauch vs. Budget nach Kundensegment'
                        }
                    }
                }
            });
        }

        function createClusterSummary(data) {
            const summaryContainer = document.getElementById('clusterSummary');

            data.clusters.forEach((cluster, index) => {
                const card = document.createElement('div');
                card.className = `cluster-card ${cluster.name.toLowerCase().replace('kunden', '')}`;

                const avgVerbrauch = cluster.members.reduce((sum, m) => sum + m.jahresverbrauch, 0) / cluster.members.length;
                const avgBudget = cluster.members.reduce((sum, m) => sum + m.budget, 0) / cluster.members.length;

                card.innerHTML = `
                    <h3>${cluster.name}</h3>
                    <div class="metric">
                        <span class="metric-label">Mitglieder:</span>
                        <span class="metric-value">${cluster.size}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Ø Jahresverbrauch:</span>
                        <span class="metric-value">${Math.round(avgVerbrauch)} kWh</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Ø Budget:</span>
                        <span class="metric-value">${Math.round(avgBudget)} €</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Cluster-Qualität:</span>
                        <span class="metric-value">${cluster.quality.silhouetteScore.toFixed(3)}</span>
                    </div>
                `;

                summaryContainer.appendChild(card);
            });
        }
    </script>
</body>
</html>